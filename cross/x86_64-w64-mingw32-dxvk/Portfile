# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        gcenx DXVK-macOS 1.10.2 v
github.tarball_from releases

categories          cross
maintainers         {@gcenx}
license             zlib

supported_archs     noarch
description         Vulkan-based implementation of D3D10 and D3D11 for macOS / Wine, MingW version
long_description    ${description}

name                x86_64-w64-mingw32-dxvk
dist_subdir         x86_64-w64-mingw32-dxvk

distname            dxvk-macOS-async-${version}
checksums           rmd160  c38f8919f82c522d44e3068df9254e3c43c8688d \
                    sha256  58ea0bc7bb0ab88656ca871f6d05c7a53a010972d8abfb7db04843cf1c0a998a \
                    size    2900946

use_configure       no
build {}

destroot {
    copy ${filespath}/setup_dxvk.sh ${workpath}/setup_dxvk.sh
    reinplace s|@@PREFIX@@|${prefix}|g ${workpath}/setup_dxvk.sh
    xinstall -m 0755 -d ${destroot}${prefix}/share/wine/dxvk/x64
    xinstall -m 0644 {*}[glob ${workpath}/${distname}/x64/*] ${destroot}${prefix}/share/wine/dxvk/x64
    xinstall -m 0644 ${workpath}/${distname}/setup_dxvk.sh ${destroot}${prefix}/share/wine/dxvk/setup_dxvk.sh
    xinstall -m 0644 ${workpath}/setup_dxvk.sh ${destroot}${prefix}/bin/setup_dxvk.sh
}

notes "
Use setup_dxvk.sh to install the ${github.project} dlls into place.
Running \"setup_dxvk.sh install\" will install the dlls into the WINEPREFIX.
"

platform darwin {
    if {${os.major} < 15} {
        archive_sites
        distfiles
        depends_build
        pre-fetch {
            ui_error "${subport} @${version} requires OS X El Capitan or later"
            return -code error "incompatible OS X version"
        }
    }
}
