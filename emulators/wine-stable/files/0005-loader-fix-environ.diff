From bc737a345161b431b9a30baa18d14f8260d61094 Mon Sep 17 00:00:00 2001
From: Dean M Greer <38226388+Gcenx@users.noreply.github.com>
Date: Thu, 24 Nov 2022 12:24:39 -0500
Subject: [PATCH] loader: Fix environ being NULL on macOS Big Sur and later

https://gitlab.winehq.org/wine/wine/-/merge_requests/1396#note_17218
https://www.gnu.org/software/gnulib/manual/html_node/environ.html
---
 loader/main.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/loader/main.c b/loader/main.c
index 242ff15accd..18014fb40f2 100644
--- a/loader/main.c
+++ b/loader/main.c
@@ -36,7 +36,8 @@
 
 #include "main.h"
 
-extern char **environ;
+#include <crt_externs.h>
+#define environ (*_NSGetEnviron())
 
 /* the preloader will set this variable */
 const struct wine_preload_info *wine_main_preload_info = NULL;
--
2.37.1 (Apple Git-137.1)
